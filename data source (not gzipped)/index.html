<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kea CO2</title>
    <link rel="stylesheet" href="index.css">
    <script src="apexcharts.min.js"></script>
</head>
<script>
    function select(element) {
        document.querySelectorAll('.selected').forEach(e => { e.classList.remove('selected') })
        element.querySelector('.activeIndicator').classList.add('selected')
    }
</script>

<body>
    <div class="page">
        <div class="sideBar">
            <a href="#download">
                <div class="item" onclick="select(this)">
                    <div class="activeIndicator selected">
                        <img class="icon" src="download.svg">
                    </div>
                    <div class="label">Download</div>
                </div>
            </a>
            <a href="#CO2">
                <div class="item" onclick="select(this)">
                    <div class="activeIndicator">
                        <img class="icon" src="co2.svg">
                    </div>
                    <div class="label">CO2</div>
                </div>
            </a>
            <a href="#Humidity">
                <div class="item" onclick="select(this)">
                    <div class="activeIndicator">
                        <img class="icon" src="humidity.svg">
                    </div>
                    <div class="label">Humidity</div>
                </div>
            </a>
            <a href="#Temperature">
                <div class="item" onclick="select(this)">
                    <div class="activeIndicator">
                        <img class="icon" src="temperature.svg">
                    </div>
                    <div class="label">Temp</div>
                </div>
            </a>
            <a href="#Light">
                <div class="item" onclick="select(this)">
                    <div class="activeIndicator">
                        <img class="icon" src="light.svg">
                    </div>
                    <div class="label">Light</div>
                </div>
            </a>
        </div>
        <div class="content">
            <div class="card" id="download">
                <div class="cardContent">
                    <h1>Download</h1>
                    <p>Download the data as a csv file (Can be imported into Excel or Google Sheets).</p>
                    <a href="Kea-CO2-Data.csv" download="Kea-CO2-Data.csv">
                        <div class="cardButton">Download Data</div>
                    </a>
                </div>
            </div>
            <div class="card" id="CO2">
                <div class="chart" id="chartCO2"></div>
                <div class="cardContent">
                    <h1>Carbon Dioxide (CO<sub>2</sub>)</h1>
                    <p>
                        CO<sub>2</sub> is a key indicator for indoor air quality as high levels compromise humansâ€™
                        cognitive performance and well being.
                        CO<sub>2</sub> is Measured in Parts Per Million (ppm).
                        The Sensor uses a photoacoustic NDIR sensing principle and features humidity and temperature
                        compensation.
                    </p>
                    <br></br>
                    <p>Sensor Range: 400 - 40,000ppm</p>
                    <p>Sensor Accuracy: &plusmn;50ppm (400-2,000ppm)</p>
                </div>
            </div>
            <div class="card" id="Humidity">
                <div class="chart" id="chartHumidity"></div>
                <div class="cardContent">
                    <h1>Humidity</h1>
                    <p>
                        Relative humidity (%RH) is a measure of the amount of water in the air.
                        It is defined as the ratio of the partial pressure of water vapor in air to the saturation vapor
                        pressure expressed as a percentage
                    </p>
                    <br></br>
                    <p>Sensor Range: 0 - 100%RH</p>
                    <p>Sensor Accuracy: &plusmn;6%RH</p>
                </div>
            </div>
            <div class="card" id="temperature">
                <div class="chart" id="chartTemperature"></div>
                <div class="cardContent">
                    <h1>Temperature</h1>
                    <p>Sensor Range: -10 - 60&deg;C</p>
                    <p>Sensor Accuracy: &plusmn;0.8&deg;C</p>
                </div>
            </div>
            <div class="card" id="Light">
                <div class="chart" id="chartLight"></div>
                <div class="cardContent">
                    <h1>Light Level</h1>
                    <p>
                        Lux (symbol: lx) is the SI unit of illuminance per unit area. It is equal to one lumen per
                        square metre.
                        The Sensor features 50 Hz and 60 Hz (Mains Power) flicker noise rejection.
                    </p>
                    <br></br>
                    <p>Sensor Range: 0 - 120,000lx</p>
                    <p>Sensor Resolution: &plusmn;0.004lx</p>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    var numberOfDataSeries = 4
    var defaultChartOptions = {
        series: [{
            name: "Default Series Name",
            data: []
        }],
        chart: {
            type: 'line',
            height: 350,
            animations: {
                enabled: false
                //easing: 'easein',
            },
            fontFamily: 'Lato, sans-serif',
            foreColor: '#111',
            // zoom: {
            //     enabled: true,
            //     autoScaleYaxis: false,
            //     zoomedArea: {
            //         fill: {
            //             color: '#f5f5f5',
            //             opacity: 0.4
            //         },
            //         stroke: {
            //             color: '#f5f5f5',
            //             opacity: 0.4,
            //             width: 1
            //         }
            //     }
            // },
            toolbar: {
                show: true,
                tools: {
                    download: '<img class="icon" src="download.svg" width="50">',
                    selection: false,
                    zoom: false,
                    zoomin: false,
                    zoomout: false,
                    pan: false,
                    reset: false,
                }
            },
        },
        //color: '#111',
        // dataLabels: {
        //     enabled: true,
        //     style: {
        //         fontSize: '14px',
        //         fontFamily: 'Lato, sans-serif',
        //     },
        //     background: {
        //         enabled: true,
        //         foreColor: '#f5f5f5',
        //         padding: 8,
        //         borderRadius: 12,
        //         borderWidth: 0,
        //         opacity: 1,
        //     },
        // },
        stroke: {
            curve: 'smooth'
        },
        grid: {
            show: false,
        },
        markers: {
            size: 0,
            hover: {
                size: 0,
            }
        },
        xaxis: {
            axisTicks: {
                color: '#111',
            },
            axisBorder: {
                show: true,
                color: '#111',
            },
            labels: {
                style: {
                    fontSize: '12px',
                    fontWeight: 300,
                },
            },
            type: 'numeric'
        },
        yaxis: {
            title: {
                style: {
                    fontSize: '12px',
                    fontWeight: 300,
                },
            },
            axisTicks: {
                color: '#111',
                show: true,
            },
            axisBorder: {
                show: true,
                color: '#111',
            },
            labels: {
                style: {
                    colors: '#111',
                    fontSize: '12px',
                    fontFamily: 'Lato, sans-serif',
                    fontWeight: 300,
                },
            },
            type: 'numeric'
        },
    };

    var co2Options = Object.assign({}, JSON.parse(JSON.stringify(defaultChartOptions))) // clone the defaults, then overload the specifics
    co2Options.series[0].name = "CO2"
    co2Options.yaxis.title.text = 'Parts Per Million (PPM)'
    co2Options.series[0].color = '#70AE6E'

    var humidityOptions = Object.assign({}, JSON.parse(JSON.stringify(defaultChartOptions))) // clone the defaults, then overload the specifics
    humidityOptions.series[0].name = "Humidity"
    humidityOptions.yaxis.title.text = 'Relative humidity (%RH)'
    humidityOptions.series[0].color = '#333745'

    var temperatureOptions = Object.assign({}, JSON.parse(JSON.stringify(defaultChartOptions))) // clone the defaults, then overload the specifics
    temperatureOptions.series[0].name = "Temperature"
    temperatureOptions.yaxis.title.text = 'Temperature (\xB0C)'
    temperatureOptions.series[0].color = '#FE5F55'

    var lightOptions = Object.assign({}, JSON.parse(JSON.stringify(defaultChartOptions))) // clone the defaults, then overload the specifics
    lightOptions.series[0].name = "Light Level"
    lightOptions.yaxis.title.text = 'Lux (lm/m\xB2)'
    lightOptions.series[0].color = '#8B6220'

    var chartCO2 = new ApexCharts(document.querySelector("#chartCO2"), co2Options);
    var chartHumidity = new ApexCharts(document.querySelector("#chartHumidity"), humidityOptions);
    var chartTemperature = new ApexCharts(document.querySelector("#chartTemperature"), temperatureOptions);
    var chartLight = new ApexCharts(document.querySelector("#chartLight"), lightOptions);

    window.onload = getData

    function getData() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var lines = this.responseText.split("\n");
                lines && lines.forEach((line, lineNumber) => {
                    line = line.replace(/,\s*$/, "") // remove any trailing comma and white space
                    var rowValues = line.split(",")
                    if (rowValues.length != (numberOfDataSeries + 1)) { // skip incomplete lines
                        console.log(`Line #${lineNumber} has ${rowValues.length} values, but we were expecting ${numberOfDataSeries + 2}\nLine: ${line}`)
                    } else {
                        if (lineNumber != 0) { // ignore header row values
                            rowValues = rowValues.map(val => val.replace('\r', '')) // clean up \r from any values

                            co2Options.series[0].data.push({ x: `${rowValues[0]}`, y: rowValues[1] })
                            humidityOptions.series[0].data.push({ x: `${rowValues[0]}`, y: rowValues[2] })
                            temperatureOptions.series[0].data.push({ x: `${rowValues[0]}`, y: rowValues[3] })
                            lightOptions.series[0].data.push({ x: `${rowValues[0]}`, y: rowValues[4] })
                        }
                    }
                })
                // push null value at end (x is a non-breaking space)
                co2Options.series[0].data.push({ x: '\xa0', y: null })
                humidityOptions.series[0].data.push({ x: '\xa0', y: null })
                temperatureOptions.series[0].data.push({ x: '\xa0', y: null })
                lightOptions.series[0].data.push({ x: '\xa0', y: null })

                chartCO2.render()
                chartHumidity.render()
                chartTemperature.render()
                chartLight.render()
            }
        };
        xhttp.open("GET", "Kea-CO2-Data.csv", true);
        xhttp.send();
    }
</script>

</html>